#### Deploy Cognito Stack

Replace CallbackUrl, LogoutUrl with your CloudFront URL from your deployed frontend

```bash
aws cloudformation deploy \
    --stack-name free-app-auth \
    --template-file infra/auth-cognito.yml \
    --capabilities CAPABILITY_NAMED_IAM \
    --parameter-overrides \
        AppName=free-app \
        CallbackUrl=https://YOUR_CLOUDFRONT_URL \
        LogoutUrl=https://YOUR_CLOUDFRONT_URL \
        DomainPrefix=free-app \
    --profile free-app-ci
```

#### Get Stack Outputs (Cognito User Pool)
```bash
aws cloudformation describe-stacks \
  --stack-name free-app-auth \
  --profile free-app-ci \
  --query "Stacks[0].Outputs"
```

#### Deploy Auth Lambda

NOTE: SAM Template is very picky about how the Origin URL is passed in. 

The URL must look EXACTLY like this when consumed by the template: 

"'https://www.URL.com'" OR "'http://localhost:51733'"

Below the Parameter Override has been formatted to avoid quotes being stripped from the input.

##### Build SAM Template
```bash
sam build --template-file infra/auth-lambda.yml
```

###### Deploy Dev Stack
```bash
sam deploy \
  --stack-name free-app-auth-lambda-dev \
  --profile free-app-ci \
  --parameter-overrides \
    CognitoRegion=us-west-2 \
    CognitoUserPoolId=us-west-2_******* \
    StageName=Dev \
    "CloudFrontOrigin=\"'http://localhost:5173'\"" \
  --resolve-s3 \
  --capabilities CAPABILITY_IAM
```

###### Deploy Prod Stack
```bash
sam deploy \
  --stack-name free-app-auth-lambda-prod \
  --profile free-app-ci \
  --parameter-overrides \
    CognitoRegion=us-west-2 \
    CognitoUserPoolId=us-west-2_******* \
    StageName=Prod \
    "CloudFrontOrigin=\"'https://YOUR_CLOUDFRONT_URL.net'\"" \
  --resolve-s3 \
  --capabilities CAPABILITY_IAM
```


#### Get Stack Outputs (Auth Lambda API URL)
```bash
# Prod
aws cloudformation describe-stacks \
  --stack-name free-app-auth-lambda-prod \
  --profile free-app-ci \
  --query "Stacks[0].Outputs"

# Dev
aws cloudformation describe-stacks \
  --stack-name free-app-auth-lambda-dev \
  --profile free-app-ci \
  --query "Stacks[0].Outputs"
```